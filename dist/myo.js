!function(){var t;"undefined"==typeof window?t=require("ws"):("WebSocket"in window||console.error("Myo.js : Sockets not supported :("),t=WebSocket);var e=function(){var t={};for(var e in arguments){var o=arguments[e];for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])}return t},o=0,n=function(){return o++,(new Date).getTime()+""+o},i=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w);return{w:t.w/e,x:-t.x/e,y:-t.y/e,z:-t.z/e}},r=function(t,e){return{w:t.w*e.w-t.x*e.x-t.y*e.y-t.z*e.z,x:t.w*e.x+t.x*e.w+t.y*e.z-t.z*e.y,y:t.w*e.y-t.x*e.z+t.y*e.w+t.z*e.x,z:t.w*e.z+t.x*e.y-t.y*e.x+t.z*e.w}},s={pose:function(t,e){t.trigger(t.lastPose,!1),t.trigger("pose",t.lastPose,!1),t.trigger(e.pose,!0),t.trigger("pose",e.pose,!0),t.lastPose=e.pose},rssi:function(t,e){t.trigger("bluetooth_strength",e.rssi)},orientation:function(t,e){t._lastQuant=e.orientation,ori=r(t.orientationOffset,e.orientation);var o={orientation:ori,accelerometer:{x:e.accelerometer[0],y:e.accelerometer[1],z:e.accelerometer[2]},gyroscope:{x:e.gyroscope[0],y:e.gyroscope[1],z:e.gyroscope[2]}};t.lastIMU||(t.lastIMU=o),t.trigger("orientation",o.orientation),t.trigger("accelerometer",o.accelerometer),t.trigger("gyroscope",o.gyroscope),t.trigger("imu",o),t.lastIMU=o},emg:function(t,e){t.trigger(e.type,e.emg)},arm_synced:function(t,e){t.arm=e.arm,t.direction=e.x_direction,t.trigger(e.type,e),t.trigger("status",e)},arm_unsynced:function(t,e){t.arm=void 0,t.direction=void 0,t.trigger(e.type,e),t.trigger("status",e)},connected:function(t,e){t.connect_version=e.version.join("."),t.isConnected=!0;for(var o in e)t[o]=e[o];t.trigger(e.type,e),t.trigger("status",e)},disconnected:function(t,e){t.isConnected=!1,t.trigger(e.type,e),t.trigger("status",e)}},c=function(t){var e=JSON.parse(t.data)[1];Myo.myos[e.myo]&&(s[e.type]?s[e.type](Myo.myos[e.myo],e):Myo.myos[e.myo].trigger("status",e))},a=function(t,e,o){var n=this;return t.map(function(t){if(t.name==e&&t.fn.apply(n,o),"*"==t.name){var i=o.slice(0);i.unshift(e),t.fn.apply(n,i)}}),this},y=function(t,e,o){var i=n();return t.push({id:i,name:e,fn:o}),i},u=function(t,e){return t=t.reduce(function(t,o){return o.name==e||o.id==e?t:(t.push(o),t)},[])},m={isLocked:!1,isConnected:!1,orientationOffset:{x:0,y:0,z:0,w:1},lastIMU:void 0,socket:void 0,arm:void 0,direction:void 0,events:[],trigger:function(t){var e=Array.prototype.slice.apply(arguments).slice(1);return a.call(this,Myo.events,t,e),a.call(this,this.events,t,e),this},on:function(t,e){return y(this.events,t,e)},off:function(t){this.events=u(this.events,t)},timer:function(t,e,o){t?this.timeout=setTimeout(o.bind(this),e):clearTimeout(this.timeout)},lock:function(){return this.isLocked?!0:(Myo.socket.send(JSON.stringify(["command",{command:"lock",myo:this.id}])),this.isLocked=!0,this.trigger("lock"),this)},unlock:function(t){var e=this;return clearTimeout(this.lockTimeout),t?(Myo.socket.send(JSON.stringify(["command",{command:"unlock",myo:this.id,type:"hold"}])),this.lockTimeout=setTimeout(function(){e.lock()},t)):Myo.socket.send(JSON.stringify(["command",{command:"unlock",myo:this.id,type:"timed"}])),this.isLocked?(this.isLocked=!1,this.trigger("unlock"),this):this},zeroOrientation:function(){return this.orientationOffset=i(this._lastQuant),this.trigger("zero_orientation"),this},setLockingPolicy:function(t){return t=t||"standard",Myo.socket.send(JSON.stringify(["command",{command:"set_locking_policy",type:t}])),this},vibrate:function(t){return t=t||"medium",Myo.socket.send(JSON.stringify(["command",{command:"vibrate",myo:this.id,type:t}])),this},requestBluetoothStrength:function(){return Myo.socket.send(JSON.stringify(["command",{command:"request_rssi",myo:this.id}])),this},streamEMG:function(t){var e="enabled";return t===!1&&(e="disabled"),Myo.socket.send(JSON.stringify(["command",{command:"set_stream_emg",myo:this.id,type:e}])),this}};Myo={options:{api_version:3,socket_url:"ws://127.0.0.1:10138/myo/"},events:[],myos:[],create:function(t,o){if(t||(t=0),Myo.myos[t])return Myo.myos[t];Myo.socket||Myo.initSocket(),"object"==typeof t&&(o=t),o=o||{};var n=Object.create(m);return n.options=e(Myo.options,o),n.events=[],n.id=t,Myo.myos[t]=n,n},onError:function(){throw"Myo.js had an error with the socket. Myo Connect might not be running. If it is, double check the API version."},trigger:function(t){var e=Array.prototype.slice.apply(arguments).slice(1);return a.call(Myo,Myo.events,t,e),Myo},on:function(t,e){return y(Myo.events,t,e)},initSocket:function(){Myo.socket=new t(Myo.options.socket_url+Myo.options.api_version),Myo.socket.onmessage=c,Myo.socket.onerror=Myo.onError}},"undefined"!=typeof module&&(module.exports=Myo)}();